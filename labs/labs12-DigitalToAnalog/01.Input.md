# สวิตช์บน Arduino:  การทำงานและการใช้ Pull-Up และ Pull-Down

**สวิตช์** เป็นส่วนประกอบโอิเล็กทรอนิกส์พื้นฐานที่ใช้ในการควบคุมการไหลของกระแสไฟฟ้าผ่านวงจร มีหลายประเภทของสวิตช์ เช่น
สวิตช์แบบกดปุ่ม (push button switch) สวิตช์แบบสไลด์ (slide switch) และสวิตช์แบบหมุน (rotary switch)

## Push Button

สวิตช์กดเป็นอุปกรณ์อิเล็กทรอนิกส์ที่ใช้เพื่อควบคุมการไหลของกระแสไฟฟ้าโดยการกดปุ่ม
เมื่อไม่ได้กดปุ่มจะไม่มีกระแสไฟฟ้าไหลผ่านแต่เมื่อกดปุ่มกระแสไฟฟ้าจะไหลผ่าน

Push Switch มีสี่ขาโดยขา 1 และ 3 เชื่อมต่อกันและขา 2 และ 4 เชื่อมต่อกัน

![push-button.png](files%2Fimg%2Fpush-button.png)

## Pull-Up และ Pull-Down Resistors

* **Pull-Up Resistor:**  คือการกำหนดสัญญาณ 1 ให้กับสวิตช์ตลอดเวลา เมื่อสวิตช์ถูกกดจะให้สัญญาณ 0
* **Pull-Down Resistor:**  การกำหนดสัญญาณ 0 ให้กับสวิตช์ตลอดเวลา เมื่อสวิตช์ถูกกดจะให้สัญญาณ 1

ใช้ตัวต้านทานจ่ายไฟให้กับสวิตช์ ตัวอย่างดังรูป
F
![PullUpAndPullDown2.png](files%2Fimg%2FPullUpAndPullDown2.png)

## Arduino With Pull Up

Arduino ออกแบบให้สามารถทำงานแบบ Pull UP ได้แบบไม่ต้องใช้ตัวต้านทานเพิ่ม เพียงแค่พิมพ์โคดคำสั่งให้เป็นโหมดนี้

```cpp
pinMode(ขา, INPUT_PULLUP);
```

![Snap33.jpg](files%2Fimg%2FSnap33.jpg)

ตัวอย่าง ต้องการต่อสวิตช์กับขา 2 เมื่อกดปุ่มให้ LED ที่ขา 7 ติด และเมื่อปล่อยให้ LED ดับ

1. เพื่อให้ง่ายต่อการใช้งาน กำหนดสวิตช์เป็นโหมด INPUT_PULLUP สวิตชจะมีสถานะ 1 ตลอดเวลา
2. อ่านค่าสวิตช์โดยใช้คำสั่ง digitalRead(ขาสวิตช์);
3. กำหนด LED ให้เป็นโหมด OUTPUT
4. สั่งให้ไฟ LED ติด โดยใช้คำสั่ง digitalWrite(ขา LED,1);

```cpp
void setup() {
    pinMode(2, INPUT_PULLUP);
    pinMode(7,OUTPUT);
}
void loop(){
    int sw = digitalRead(2);
    if (sw == 0) {
        digitalWrite(7,1);
    } else {
        digitalWrite(7,1);
    }
}
```

# Key Matrices

แมทริกซ์เป็นเทคนิคในการเชื่อมต่ออินพุตและเอาต์พุต โดยจะแบ่งเป็นสองส่วนคือคอลัมน์และแถว คล้ายกับแผ่นงานใน Excel
ซึ่งสามารถใช้สำหรับเชื่อมต่อปุ่มกดบนคีย์บอร์ดและควบคุม LED ได้ ตัวอย่างที่กล่าวถึงคือแมทริกซ์ขนาด 4 x 4

![howkeymatricesworks_1277635652.png](files%2Fimg%2Fhowkeymatricesworks_1277635652.png)

เส้นสีน้ำเงินคือคอลัมน์และเส้นสีแดงคือแถว จะมีจุดตัด 16 จุด
ถ้าเราต้องการสร้า งKey Matrices เราจะต้องเชื่อมต่อปุ่มกดแต่ละปุ่มเข้ากับแต่ละจุดตัด

![howkeymatricesworks_1277637426.png](files%2Fimg%2Fhowkeymatricesworks_1277637426.png)

ปุ่มกดแต่ละปุ่มจะถูกตั้งชื่อด้วยชื่อของคอลัมน์:แถวที่มันเชื่อมต่อ เช่น ปุ่มกดมุมซ้ายบนจะชื่อ A1
และปุ่มกดมุมขวาล่างจะชื่อ D4

## How does a key-matrix works?

รูปด้านล่างจะเป็นการวาดแมทริกซ์ด้านบนใหม่โดยไม่มีสี และจะใส่ขาเชื่อมต่อให้กับแต่ละสายแถวและคอลัมน์
จากนั้นจะจ่ายไฟให้กับคอลัมน์เพียงคอลัมน์เดียวนั่นคือคอลัมน์ B สายที่เป็นสีแดงจะแสดงว่ามีไฟฟ้าอยู่
และปุ่มที่เป็นสีม่วงจะแสดงว่าปุ่มนั้นถูกกดแล้ว จากนั้นจะจำลองการกดปุ่มที่หมายเลข B3:

![howkeymatricesworks_1277637947.png](files%2Fimg%2Fhowkeymatricesworks_1277637947.png)

ดูอนิเมชันข้างต้น สายคอลัมน์ B จะมีไฟฟ้าอยู่ตลอดเวลา ไม่มีสายอื่นใดที่มีไฟจนกว่าจะมีการกดปุ่ม B3
ปุ่มนี้จะทำให้เกิดการเชื่อมต่อระหว่างคอลัมน์ B และแถว 3 เมื่อคอลัมน์ B มีไฟฟ้า แถว 3 ก็จะมีไฟฟ้าเช่นกัน ตราบใดที่ปุ่ม B3
ถูกกด!

สิ่งนี้หมายความว่า หากเรารู้ว่าคอลัมน์ไหนมีไฟอยู่ในขณะนั้น และเราสังเกตแถวต่างๆ เราก็สามารถเข้าใจได้ว่าปุ่มไหนถูกกด
หากเราตรวจพบไฟฟ้าที่แถว หากเรารู้ว่าคอลัมน์ B มีไฟฟ้า และตรวจพบว่าแถว 3 ก็มีไฟฟ้า เราก็จะเข้าใจว่าปุ่ม B3 ถูกกดแล้ว

## A matrix in the real life

สำหรับแมทริกซ์ 4x4 ที่มีปุ่มกด 16 ปุ่มนี้ จะใช้ขาเชื่อมกับไมโครคอนโทรลเลอร์ทั้งหมด 8 ขา โดยขาแรก 4 ขาจะเป็น OUTPUTS
และจะเชื่อมต่อกับสายของคอลัมน์ และขาอีก 4 ขาจะเป็น INPUTS และจะเชื่อมต่อกับสายของแถว

OUTPUTS ของไมโครคอนโทรลเลอร์จะไม่สามารถมีไฟฟ้าทั้งหมดในเวลาเดียวกัน ขาจะถูกทำให้มีไฟ (high) ทีละขาในลำดับอย่างต่อเนื่อง
ซึ่งจะเกิดขึ้นหลายครั้งต่อวินาที

![howkeymatricesworks_1277639564.gif](files%2Fimg%2Fhowkeymatricesworks_1277639564.gif)

นี่คือวิธีที่ไมโครคอนโทรลเลอร์จะทำการปล่อยเอาต์พุตไปที่คอลัมน์เรื่อยๆ ในระหว่างนี้
ไมโครคอนโทรลเลอร์จะตรวจสอบอินพุตเพื่อหาสัญญาณจากสายแถว หากอินพุตทั้งหมดอยู่ที่ LOW ไมโครคอนโทรลเลอร์จะไม่ทำการใดๆ

สมมติว่าผู้ใช้กดปุ่ม 3C ลองดูสิ่งที่จะเกิดขึ้น

![howkeymatricesworks_1277649177.gif](files%2Fimg%2Fhowkeymatricesworks_1277649177.gif)

ไมโครคอนโทรลเลอร์จะวนลูปเอาต์พุตตามปกติในขณะที่ผู้ใช้ได้กดปุ่ม C3 ปุ่มนี้ได้เชื่อมต่อคอลัมน์ C กับแถว 3
เมื่อเอาต์พุตของคอลัมน์ C
ของไมโครคอนโทรลเลอร์เป็น HIGH สัญญาณก็จะส่งไปยังอินพุต 3 ของไมโครคอนโทรลเลอร์ผ่านปุ่มที่ถูกกด

ไมโครคอนโทรลเลอร์จะตรวจสอบอินพุตทั้ง 4 และตรวจพบว่าเมื่อเอาต์พุตเฉพาะ (C) เป็น HIGH จะมีสัญญาณ HIGH ที่อินพุต 3
ดังนั้นหมายความว่าปุ่ม C3 นั้นถูกกด

For more resources: https://pcbheaven.com/wikipages/How_Key_Matrices_Works/

## Exercise 1: Digital Input

ให้ใช้ Switch กับ LED

- เมื่อกด Switch แล้วไฟ LED จะเปลี่ยนสถานะ (เปิดไปปิด, ปิดไปเปิด)
- **Tinkercad**
    - [Pull Up](https://www.tinkercad.com/things/eIF9FVqnx7H-l21-led-and-switch-pull-up?sharecode=yhk6NOJbJE11-tuehxgdLl0NhvozczwZtV4gJVTSrAc) <br/>
    - [Pull Down](https://www.tinkercad.com/things/bk5DzidrknQ-l21-led-and-switch-pull-down?sharecode=ABUz4OiP6ag6g5-p-S4vjg-RUZhOdgmLqYdeUVlPG7A)

![L2.1.png](files%2Fimg%2FL2.1.png)

## Exercise 2: Color LED Switch

ต่อ Switch จำนวน 3 ตัว เมื่อกด switch แต่ละตัว ให้ Color LED ติดคนละสีเช่น Red, Green , Blue และเมื่อปล่อย switch ให้
Color LED ดับ

- Hint:
    - [Tinkercad](https://www.tinkercad.com/things/2XUCW6PST9y-l22-rgb-switch-pull-up?sharecode=MbJjTXbM3f66N94bDamYrwzpsqfuQTjNNado4DRArE0)

    - ใน Tinkercad เป็น Common Cathode ถ้าต่อจริงให้เปลี่ยนเป็น Common Anode ด้วย

![L2.2.png](files%2Fimg%2FL2.2.png)

## References

- [วงจร Digital Input Pull Up และ Pull Down ต่างกันอย่างไร](https://dkttc.ac.th/?p=627#:~:text=1.%20Pull%20UP%20%E0%B8%84%E0%B8%B7%E0%B8%AD%E0%B8%81%E0%B8%B2%E0%B8%A3,Pull%20UP%20%E0%B8%A1%E0%B8%B5%E0%B9%81%E0%B8%96%E0%B8%A1%E0%B8%9E%E0%B8%B4%E0%B9%80%E0%B8%A8%E0%B8%A9)
- [How a Key Matrix Work](https://pcbheaven.com/wikipages/How_Key_Matrices_Works/)